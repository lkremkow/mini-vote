{"code":"Object.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar core_1 = require(\"@angular/core\");\r\nvar meteor_1 = require(\"meteor/meteor\");\r\nvar meteor_rxjs_1 = require(\"meteor-rxjs\");\r\nvar fixtures_1 = require(\"../../../../imports/collections/fixtures\");\r\nvar globaldata_service_1 = require(\"../../../../imports/global/globaldata.service\");\r\nvar HomeComponent = /** @class */ (function () {\r\n    function HomeComponent(zone, globalData) {\r\n        this.zone = zone;\r\n        this.globalData = globalData;\r\n        this.myPositions = [];\r\n        this.geolocationStatus = false;\r\n        this.geolocationMessage = \"unset\";\r\n        this.newFixture = {\r\n            latitude: 0,\r\n            longitude: 0\r\n        };\r\n        this.myPositionAverage = {\r\n            latitude: 0,\r\n            longitude: 0,\r\n            altitude: 0,\r\n            heading: 0,\r\n            speed: 0\r\n        };\r\n        if (this.globalData.shareObj['session_id'] === undefined) {\r\n            this.globalData.shareObj['session_id'] = Math.trunc(Math.random() * 100000000000000000);\r\n        }\r\n        else {\r\n            this.session_id = this.globalData.shareObj['session_id'];\r\n        }\r\n        ;\r\n        this.newFixture.longitude = this.myPositionAverage.longitude;\r\n        this.myZoomLevel = 10;\r\n        this.resetPositions();\r\n        this.getLocation();\r\n    }\r\n    ;\r\n    HomeComponent.prototype.ngOnInit = function () {\r\n        var _this = this;\r\n        this.fixtureSubscription = meteor_rxjs_1.MeteorObservable.subscribe('allFixtures').subscribe(function () {\r\n            _this.autoRunFixtures = meteor_rxjs_1.MeteorObservable.autorun().subscribe(function () {\r\n                _this.zone.run(function () {\r\n                    _this.fixtures = fixtures_1.Fixtures.find({}).fetch();\r\n                });\r\n            });\r\n        });\r\n        console.log(\"OnInit for home component\");\r\n    };\r\n    ;\r\n    HomeComponent.prototype.getLocation = function () {\r\n        var _this = this;\r\n        if (window.navigator && window.navigator.geolocation) {\r\n            this.geolocationMessage = \"available\";\r\n            this.watchIdHandler = window.navigator.geolocation.watchPosition(function (geoPosition) {\r\n                _this.myPositions.push({\r\n                    latitude: _this.roundNumber(6, geoPosition.coords.latitude),\r\n                    longitude: _this.roundNumber(6, geoPosition.coords.longitude),\r\n                    altitude: _this.roundNumber(0, geoPosition.coords.altitude),\r\n                    heading: _this.roundNumber(0, geoPosition.coords.heading),\r\n                    speed: _this.roundNumber(0, (geoPosition.coords.speed / 1000) * 3600)\r\n                });\r\n                _this.myPositions.shift();\r\n                _this.updatePositionAverage();\r\n                _this.geolocationStatus = false;\r\n            }, function (geoError) {\r\n                _this.geolocationStatus = false;\r\n                _this.resetPositions();\r\n                _this.geolocationMessage = \"geolocation is no longer available\";\r\n                window.navigator.geolocation.clearWatch(_this.watchIdHandler);\r\n            }, {\r\n                maximumAge: 1000,\r\n                timeout: 1000,\r\n                enableHighAccuracy: true\r\n            });\r\n        }\r\n        else {\r\n            this.geolocationMessage = \"not available, perhaps not supported by browser or permission was refused\";\r\n        }\r\n        ;\r\n    };\r\n    ;\r\n    HomeComponent.prototype.ngOnDestroy = function () {\r\n        if (this.watchIdHandler) {\r\n            window.navigator.geolocation.clearWatch(this.watchIdHandler);\r\n        }\r\n        ;\r\n        if (this.fixtureSubscription) {\r\n            this.fixtureSubscription.unsubscribe();\r\n        }\r\n        ;\r\n        if (this.autoRunFixtures) {\r\n            this.autoRunFixtures.unsubscribe();\r\n        }\r\n        ;\r\n        console.log(\"OnDestroy for home component\");\r\n    };\r\n    ;\r\n    HomeComponent.prototype.resetPositions = function () {\r\n        this.myPositions.length = 0;\r\n        var nullPosition = {\r\n            latitude: 0,\r\n            longitude: 0,\r\n            altitude: 0,\r\n            heading: 0,\r\n            speed: 0\r\n        };\r\n        this.myPositions.push(nullPosition, nullPosition, nullPosition);\r\n        this.updatePositionAverage();\r\n    };\r\n    ;\r\n    HomeComponent.prototype.updatePositionAverage = function () {\r\n        this.myPositionAverage = {\r\n            latitude: this.roundNumber(6, (this.myPositions[0].latitude + this.myPositions[1].latitude + this.myPositions[2].latitude) / 3),\r\n            longitude: this.roundNumber(6, (this.myPositions[0].longitude + this.myPositions[1].longitude + this.myPositions[2].longitude) / 3),\r\n            altitude: this.roundNumber(0, (this.myPositions[0].altitude + this.myPositions[1].altitude + this.myPositions[2].altitude) / 3),\r\n            heading: this.roundNumber(0, (this.myPositions[0].heading + this.myPositions[1].heading + this.myPositions[2].heading) / 3),\r\n            speed: this.roundNumber(0, (this.myPositions[0].speed + this.myPositions[1].speed + this.myPositions[2].speed) / 3)\r\n        };\r\n        this.newFixture.latitude = this.myPositionAverage.latitude;\r\n        this.newFixture.longitude = this.myPositionAverage.longitude;\r\n        if (this.myPositionAverage.speed >= 0 && this.myPositionAverage.speed < 6) {\r\n            this.myZoomLevel = 18;\r\n        }\r\n        else if (this.myPositionAverage.speed >= 68 && this.myPositionAverage.speed < 35) {\r\n            this.myZoomLevel = 17;\r\n        }\r\n        else if (this.myPositionAverage.speed >= 38 && this.myPositionAverage.speed < 55) {\r\n            this.myZoomLevel = 16;\r\n        }\r\n        else if (this.myPositionAverage.speed >= 58 && this.myPositionAverage.speed < 95) {\r\n            this.myZoomLevel = 15;\r\n        }\r\n        else if (this.myPositionAverage.speed >= 98 && this.myPositionAverage.speed < 135) {\r\n            this.myZoomLevel = 14;\r\n        }\r\n        else if (this.myPositionAverage.speed >= 135 && this.myPositionAverage.speed < 185) {\r\n            this.myZoomLevel = 13;\r\n        }\r\n        else if (this.myPositionAverage.speed >= 185 && this.myPositionAverage.speed < 450) {\r\n            this.myZoomLevel = 12;\r\n        }\r\n        else if (this.myPositionAverage.speed >= 450) {\r\n            this.myZoomLevel = 11;\r\n        }\r\n        ;\r\n    };\r\n    ;\r\n    HomeComponent.prototype.roundNumber = function (numberOfDecimals, numberToRound) {\r\n        var roundedNumber = 0;\r\n        if (numberToRound != null) {\r\n            roundedNumber = numberToRound;\r\n        }\r\n        ;\r\n        var multiplier = 1;\r\n        if (numberOfDecimals >= 0 && numberOfDecimals < 10) {\r\n            multiplier = Math.pow(10, numberOfDecimals);\r\n        }\r\n        ;\r\n        roundedNumber = (Math.trunc(Math.round(numberToRound * multiplier))) / multiplier;\r\n        return roundedNumber;\r\n    };\r\n    ;\r\n    HomeComponent.prototype.addFixture = function () {\r\n        meteor_1.Meteor.call('addFixture', this.newFixture);\r\n    };\r\n    ;\r\n    HomeComponent = tslib_1.__decorate([\r\n        core_1.Component({\r\n            selector: 'home',\r\n            templateUrl: 'home.html',\r\n            styleUrls: ['home.scss']\r\n        }),\r\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof core_1.NgZone !== \"undefined\" && core_1.NgZone) === \"function\" && _a || Object, globaldata_service_1.GlobalDataService])\r\n    ], HomeComponent);\r\n    return HomeComponent;\r\n    var _a;\r\n}());\r\nexports.HomeComponent = HomeComponent;\r\n;\r\n//# sourceMappingURL=home.component.js.map","sourceMap":{"version":3,"file":"home.component.js","sourceRoot":"","sources":["client/imports/app/home/home.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, OnDestroy, NgZone } from '@angular/core';\nimport { Observable, Subscription } from 'rxjs';\n\nimport { Meteor } from 'meteor/meteor';\nimport { MeteorObservable } from 'meteor-rxjs';\n\nimport { geographicCoordinate } from '../../../../imports/models/geographicCoordinate';\nimport { Fixture } from '../../../../imports/models/fixture';\n\nimport { Fixtures } from '../../../../imports/collections/fixtures';\n\nimport { GlobalDataService } from '../../../../imports/global/globaldata.service';\n\n@Component({\n  selector: 'home',\n  templateUrl: 'home.html',\n  styleUrls: ['home.scss']\n})\n\nexport class HomeComponent implements OnDestroy, OnDestroy {\n\n  fixtures: Fixture[];\n  fixtureSubscription: Subscription;\n  autoRunFixtures: Subscription;\n\n  geolocationStatus: boolean;\n  geolocationMessage: string;\n\n  watchIdHandler: number;\n\n  myPositions: geographicCoordinate[];\n  myPositionAverage: geographicCoordinate;\n\n  myZoomLevel: number;\n\n  newFixture: Fixture;\n\n  session_id: string;\n\n  constructor(private zone: NgZone, private globalData: GlobalDataService) {\n    this.myPositions = [];\n    this.geolocationStatus = false;\n    this.geolocationMessage = \"unset\";\n    this.newFixture = {\n      latitude: 0,\n      longitude: 0\n    };\n    this.myPositionAverage = {\n      latitude: 0,\n      longitude: 0,\n      altitude: 0,\n      heading: 0,\n      speed: 0\n    };\n    if ( this.globalData.shareObj['session_id'] === undefined ) {\n      this.globalData.shareObj['session_id'] = Math.trunc(Math.random() * 100000000000000000);\n    } else {\n      this.session_id = this.globalData.shareObj['session_id'];\n    };\n    this.newFixture.longitude = this.myPositionAverage.longitude;\n    this.myZoomLevel = 10;\n    this.resetPositions();\n    this.getLocation();\n  };\n\n  ngOnInit() {\n    this.fixtureSubscription = MeteorObservable.subscribe('allFixtures').subscribe(\n      () => {\n        this.autoRunFixtures = MeteorObservable.autorun().subscribe(() => {\n          this.zone.run(() => {\n            this.fixtures = Fixtures.find({}).fetch();\n          })\n        })\n    });\n    console.log(\"OnInit for home component\");\n  };\n\n  private getLocation(): void {\n    if (window.navigator && window.navigator.geolocation) {\n      this.geolocationMessage = \"available\";\n      this.watchIdHandler = window.navigator.geolocation.watchPosition(\n        (geoPosition) => {\n          this.myPositions.push(\n            {\n              latitude: this.roundNumber(6, geoPosition.coords.latitude),\n              longitude: this.roundNumber(6, geoPosition.coords.longitude),\n              altitude: this.roundNumber(0, geoPosition.coords.altitude),\n              heading: this.roundNumber(0, geoPosition.coords.heading),\n              speed: this.roundNumber(0, (geoPosition.coords.speed / 1000) * 3600)\n            }\n          );\n          this.myPositions.shift();\n          this.updatePositionAverage();\n          this.geolocationStatus = false;          \n        },\n        (geoError) => {\n          this.geolocationStatus = false;\n          this.resetPositions();\n          this.geolocationMessage = \"geolocation is no longer available\";\n          window.navigator.geolocation.clearWatch(this.watchIdHandler);\n        },\n        {\n          maximumAge: 1000,\n          timeout: 1000,\n          enableHighAccuracy: true\n        }\n      );\n    } else {\n      this.geolocationMessage = \"not available, perhaps not supported by browser or permission was refused\";\n    };\n\n  };\n\n  ngOnDestroy(): void {\n    if (this.watchIdHandler) {\n      window.navigator.geolocation.clearWatch(this.watchIdHandler);\n    };\n    if (this.fixtureSubscription) {\n      this.fixtureSubscription.unsubscribe();\n    };\n    if (this.autoRunFixtures) {\n      this.autoRunFixtures.unsubscribe();\n    };\n    console.log(\"OnDestroy for home component\");\n  };\n\n  private resetPositions(): void {\n    this.myPositions.length = 0;\n    let nullPosition: geographicCoordinate = {\n      latitude: 0,\n      longitude: 0,\n      altitude: 0,\n      heading: 0,\n      speed: 0\n    };\n    this.myPositions.push(nullPosition, nullPosition, nullPosition);\n    this.updatePositionAverage();\n  };\n\n  private updatePositionAverage(): void {\n    this.myPositionAverage = {\n      latitude: this.roundNumber(6, (this.myPositions[0].latitude + this.myPositions[1].latitude + this.myPositions[2].latitude) / 3),\n      longitude: this.roundNumber(6, (this.myPositions[0].longitude + this.myPositions[1].longitude + this.myPositions[2].longitude) / 3),\n      altitude: this.roundNumber(0, (this.myPositions[0].altitude + this.myPositions[1].altitude + this.myPositions[2].altitude) / 3),\n      heading: this.roundNumber(0, (this.myPositions[0].heading + this.myPositions[1].heading + this.myPositions[2].heading) / 3),\n      speed: this.roundNumber(0, (this.myPositions[0].speed + this.myPositions[1].speed + this.myPositions[2].speed) / 3)\n    };\n\n    this.newFixture.latitude = this.myPositionAverage.latitude;\n    this.newFixture.longitude = this.myPositionAverage.longitude;\n\n    if ( this.myPositionAverage.speed >= 0 && this.myPositionAverage.speed < 6 ) {\n      this.myZoomLevel = 18;\n    } else if ( this.myPositionAverage.speed >= 68&& this.myPositionAverage.speed < 35 ) {\n      this.myZoomLevel = 17;\n    } else if ( this.myPositionAverage.speed >= 38 && this.myPositionAverage.speed < 55 ) {\n      this.myZoomLevel = 16;\n    } else if ( this.myPositionAverage.speed >= 58 && this.myPositionAverage.speed < 95 ) {\n      this.myZoomLevel = 15;\n    } else if ( this.myPositionAverage.speed >= 98 && this.myPositionAverage.speed < 135 ) {\n      this.myZoomLevel = 14;\n    } else if ( this.myPositionAverage.speed >= 135 && this.myPositionAverage.speed < 185 ) {\n      this.myZoomLevel = 13;\n    } else if ( this.myPositionAverage.speed >= 185 && this.myPositionAverage.speed < 450 ) {\n      this.myZoomLevel = 12;\n    } else if ( this.myPositionAverage.speed >= 450 ) {\n      this.myZoomLevel = 11;\n    };\n  };\n\n  private roundNumber(numberOfDecimals: number, numberToRound: number): number {\n    let roundedNumber = 0;\n    if (numberToRound != null) {\n      roundedNumber = numberToRound;\n    };\n    let multiplier = 1;\n    if (numberOfDecimals >= 0 && numberOfDecimals < 10 ) {\n      multiplier = Math.pow(10, numberOfDecimals);\n    };\n    roundedNumber = (Math.trunc(Math.round(numberToRound * multiplier)))/multiplier;\n    return roundedNumber;\n  };\n\n  addFixture() {\n    Meteor.call('addFixture', this.newFixture);\n  };\n\n};\n"]},"version":"1","isExternal":true,"dependencies":{"modules":["imports/models/geographicCoordinate.ts","imports/models/fixture.ts","imports/collections/fixtures.ts","imports/global/globaldata.service.ts"],"mappings":[{"modulePath":"tslib","resolvedPath":null,"external":false,"resolved":false},{"modulePath":"@angular/core","resolvedPath":null,"external":false,"resolved":false},{"modulePath":"rxjs","resolvedPath":null,"external":false,"resolved":false},{"modulePath":"meteor/meteor","resolvedPath":null,"external":false,"resolved":false},{"modulePath":"meteor-rxjs","resolvedPath":null,"external":false,"resolved":false},{"modulePath":"../../../../imports/models/geographicCoordinate","resolvedPath":"imports/models/geographicCoordinate","external":false,"resolved":true},{"modulePath":"../../../../imports/models/fixture","resolvedPath":"imports/models/fixture","external":false,"resolved":true},{"modulePath":"../../../../imports/collections/fixtures","resolvedPath":"imports/collections/fixtures","external":false,"resolved":true},{"modulePath":"../../../../imports/global/globaldata.service","resolvedPath":"imports/global/globaldata.service","external":false,"resolved":true}],"refFiles":[],"refTypings":[]},"diagnostics":{"syntacticErrors":[],"semanticErrors":[{"code":2307,"fileName":"client/imports/app/home/home.component.ts","message":"Cannot find module '@angular/core'.","line":1,"column":54},{"code":2307,"fileName":"client/imports/app/home/home.component.ts","message":"Cannot find module 'rxjs'.","line":2,"column":42},{"code":2307,"fileName":"client/imports/app/home/home.component.ts","message":"Cannot find module 'meteor/meteor'.","line":4,"column":24},{"code":2307,"fileName":"client/imports/app/home/home.component.ts","message":"Cannot find module 'meteor-rxjs'.","line":5,"column":34},{"code":2354,"fileName":"client/imports/app/home/home.component.ts","message":"This syntax requires an imported helper but module 'tslib' cannot be found.","line":14,"column":1}]},"hash":"0225464a7026a2c1893f2556d8d1d6042ad4f6b0"}